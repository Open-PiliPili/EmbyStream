# Dual Mode Configuration Example
# This configuration demonstrates how to use EmbyStream in dual mode with backend routing

[Log]
level = "info"
prefix = ""
root_path = "/var/logs/embystream"

[General]
memory_mode = "middle"
stream_mode = "dual"  # Dual mode: runs both frontend and backend

# Backend type (legacy, used when no routes configured)
# This will be ignored if [[Backend.Routes]] is configured
backend_type = "disk"

# Encryption key for secure communications (6-16 bytes)
encipher_key = "Q4eCbawEp3sCvDvx"
encipher_iv = "a3cH2abhxnu9hGo5"

[Emby]
url = "http://127.0.0.1"
port = "8096"
token = "your_emby_api_token_here"

[UserAgent]
mode = "deny"
allow_ua = []
deny_ua = ["curl", "wget", "python"]

[Http2]
ssl_cert_file = ""
ssl_key_file = ""

[Fallback]
video_missing_path = "/path/to/fallback/video.mp4"

[Frontend]
listen_port = 60001
check_file_existence = true

[[Frontend.PathRewrite]]
enable = false
pattern = "^(/.*)$"
replacement = "https://my-cdn.com$1"

[Frontend.AntiReverseProxy]
enable = false
host = ""

[Backend]
listen_port = 60002  # Different port from frontend for dual mode
base_url = "https://backend.example.com"
path = "stream"
port = "443"
proxy_mode = "proxy"
client_speed_limit_kbs = 15360
client_burst_speed_kbs = 20480
problematic_clients = []

[[Backend.PathRewrite]]
enable = false
pattern = "^(/.*)$"
replacement = "https://my-cdn.com$1"

[Backend.AntiReverseProxy]
enable = false
host = ""

# ===================================================================
# Backend Routing Configuration
# ===================================================================
# Route requests to different backends based on path patterns

[Backend.Routing]
# Match routes before path rewriting (default: false)
match_before_rewrite = false
# Match priority: "first" or "last" (default: "first")
match_priority = "first"

# Route rules (matched in order)
[[Backend.Routes]]
# Route all /movies/ paths to disk backend
pattern = "^/movies/.*"
backend_type = "disk"

[[Backend.Routes]]
# Route all /tv/ paths to OpenList backend
pattern = "^/tv/.*"
backend_type = "openlist"

[[Backend.Routes]]
# Route all /cdn/ paths to DirectLink backend
pattern = "^/cdn/.*"
backend_type = "direct_link"

# Fallback backend configuration
[Backend.Fallback]
backend_type = "disk"

# ===================================================================
# Backend Type Configurations
# ===================================================================

[Disk]
description = "Local disk storage for movies"

[OpenList]
base_url = "https://openlist.example.com"
port = "443"
token = "your_openlist_token_here"

[DirectLink]
user_agent = "Mozilla/5.0 (compatible; EmbyStream/1.0)"

